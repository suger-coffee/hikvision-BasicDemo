# 海康威视相机实时图像采集演示

![Python Version](https://img.shields.io/badge/Python-3.6+-blue)
![License](https://img.shields.io/badge/License-Hikvision-green)

一个基于 PyQt5 的海康威视工业相机实时图像采集和显示系统，支持多种接口类型（GigE、USB、CameraLink等），提供完整的相机控制、参数设置和图像保存功能。

## ✨ 核心功能

### 设备管理
- 🔍 **自动枚举** - 扫描并识别所有连接的相机设备
- 🔗 **多接口支持** - GigE、USB 3.0、CameraLink、CXP、XoF
- 📋 **设备信息显示** - 型号、IP地址、序列号等详细信息

### 图像采集
- 🎬 **连续采集模式** - 相机自动连续拍摄
- ⏱️ **触发模式** - 支持软件触发单帧采集
- 🧵 **多线程处理** - 采集线程与UI线程分离，保证界面流畅

### 实时显示
- 🖼️ **实时预览** - 采集的图像实时显示在主窗口
- 📐 **自适应缩放** - 图像自动缩放以适应显示窗口
- 🔄 **高帧率渲染** - 支持高速相机的实时显示

### 参数控制
- ⚡ **曝光时间** - 调整图像亮度和清晰度
- 📊 **增益设置** - 调节模拟增益
- 🎞️ **帧率控制** - 设置采集帧率

### 图像保存
- 💾 **BMP格式** - 无损保存原始图像
- 🎨 **JPEG格式** - 压缩保存，节省存储空间
- 📁 **自动命名** - 按帧序号自动命名

## 🚀 快速开始

### 环境要求

```
- Windows 10/11
- Python 3.6+
- 海康威视 MVS SDK
```

### 安装依赖

```bash
pip install -r requirements.txt
```

**requirements.txt 内容：**
```
PyQt5>=5.15.0
opencv-python>=4.5.0
numpy>=1.19.0
```

### 运行程序

```bash
python BasicDemo.py
```

## 📖 使用指南

### 基本工作流程

```
1. 运行程序，选择相机设备
2. 点击【枚举设备】扫描连接的相机
3. 在下拉列表中选择目标相机
4. 点击【打开设备】建立连接
5. 点击【开始采集】启动图像流
6. 实时图像显示在主窗口
7. 调整参数（曝光、增益、帧率）
8. 点击【保存图像】保存当前帧
9. 点击【停止采集】结束采集
10. 点击【关闭设备】释放资源
```

### 界面说明

| 区域 | 功能 |
|------|------|
| **设备管理区** | 设备枚举、选择、打开/关闭 |
| **采集控制区** | 开始/停止采集、软触发 |
| **模式选择区** | 连续模式/触发模式切换 |
| **参数调整区** | 曝光、增益、帧率设置 |
| **预览区域** | 实时显示采集的图像 |
| **存储操作区** | 保存当前图像为BMP或JPEG |

## 📁 项目结构

```
BasicDemo/
├── README.md                      # 项目说明文档
├── requirements.txt               # Python依赖列表
├── BasicDemo.py                   # 主程序入口（GUI应用）
├── CamOperation_class.py          # 相机操作类和采集线程
├── PyUICBasicDemo.py              # UI代码（由Qt Designer生成）
├── PyUICBasicDemo.ui              # UI设计文件（Qt Designer格式）
├── result.bmp                     # 示例输出图像
└── __pycache__/                   # Python缓存目录
```

## 🔧 关键类和方法

### CameraOperation（相机操作类）

主要方法：
- `Open_device()` - 打开相机设备
- `Start_grabbing()` - 启动采集
- `Stop_grabbing()` - 停止采集
- `Close_device()` - 关闭设备
- `Set_trigger_mode()` - 设置触发模式
- `Trigger_once()` - 执行软触发
- `Get_parameter()` - 读取相机参数
- `Set_parameter()` - 设置相机参数
- `Save_Bmp()` - 保存为BMP
- `Save_jpg()` - 保存为JPEG

### CameraGrabThread（采集线程类）

- 继承自 PyQt5 QThread
- 独立线程中持续获取图像
- 通过 `frame_ready` 信号发送图像给主线程
- 支持优雅的线程停止

## 🎯 核心改进

### 优化点

1. **线程分离** ✅
   - 图像采集运行在独立线程
   - UI保持响应性，不会卡顿

2. **实时显示** ✅
   - 采用 PyQt5 Signal/Slot 机制
   - 安全的线程间通信
   - 高效的图像格式转换

3. **像素格式支持** ✅
   - Mono8/10/12 黑白图
   - BayerRG/GR/GB/BG 彩色Bayer
   - 自动转换为BGR供OpenCV处理

4. **错误处理** ✅
   - 完整的返回值检查
   - 用户友好的错误提示
   - 资源释放保证

5. **代码规范** ✅
   - 详细的中文文档注释
   - 清晰的函数/类说明
   - 标准的参数文档

## ⚙️ 配置说明

### 相机参数

| 参数 | 范围 | 单位 | 说明 |
|------|------|------|------|
| 曝光时间 | 20-100000 | μs | 越大越亮 |
| 增益 | 0-48 | dB | 数字增益 |
| 帧率 | 1-200 | fps | 采集帧速 |

### 网络优化（GigE相机）

程序自动检测并设置最优包大小，无需手动配置。

## 🐛 常见问题

### Q：程序启动时提示"SDK初始化失败"
**A：** 检查是否正确安装了海康威视 MVS SDK

### Q：找不到相机设备
**A：** 
- 确认相机连接正确
- 检查设备驱动是否安装
- 点击【枚举设备】刷新列表

### Q：显示图像为空或异常
**A：**
- 检查相机曝光时间是否过小
- 尝试增加增益值
- 确认相机工作模式正确

### Q：保存的图像文件为0字节
**A：** 确保在采集过程中执行保存操作

## 📝 系统要求

- **操作系统** - Windows 10 或更高版本
- **Python版本** - 3.6 或更高版本
- **内存** - 最少 2GB（建议 4GB+）
- **相机设备** - 支持 MVS SDK 的海康威视工业相机

## 🔗 相关资源

- [海康威视官网](https://www.hikvision.com)
- [MVS SDK 文档](https://www.hikvision.com/cn/support/download/)
- [PyQt5 文档](https://www.riverbankcomputing.com/software/pyqt/intro)
- [OpenCV 文档](https://docs.opencv.org/)

## 📄 许可证

本项目基于海康威视示例代码，保持原有许可条款。

